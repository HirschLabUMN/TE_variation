Commands used to create TE metadata commands 

gff file use: B73.structuralTEv2.2018.12.20.filteredTE.gff3 

Age of LTR TEs: LTR similarity at the end of column 9 for every LTR described in the gff file. 
1	LTRharvest	LTR_retrotransposon	14	10255	.	.	.	ID=RLG00027Zm00001d00003;Name=RLG00027Zm00001d00003_NA_LTRsimilarity99.11
LTR ages were obtained by grepping for 'LTR_retrotransposon' lines and using sed to split the last line on '=', ';' and 'LTRsimilarity'. LTR name and simiarity were saved to a file. 

TE length obtained from coordinates of TE in gff file. 

Family size obtained by selecting the first 8 characters of every TE name (which are the family name) from B73.structuralTEv2.2018.12.20.filteredTE.gff3 and counting the number of times every family name occured. 

Maize has 2 subgenomes from a historical whole genome duplication. Use this data to assign TEs to subgenome 1, 2 or non-syntenic regions. 
bedtools intersect -a B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b ~/maize_refs/b73-syntenic-blocks-merged.txt -wo | cut -f 9,14 | tr "=" "\t" | tr ";" "\t" | cut -f 2,5 > B73_maize_subgenome_loc.txt
bedtools intersect -a B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b ~/maize_refs/b73-syntenic-blocks-merged.txt -wa -v | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tnon_syntenic"}' >> B73_maize_subgenome_loc.txt 

Finding identifying TE genomic location. The longest transcripts from the B73 v4 anntations were used. Files were created with 

Combine B73 UTR annotations into 1 line per transcript: (there were some B73 genes that had more then 1 3'/5' annotation)
python combine_UTR_anotations.py -g ../../maize_gffs/B73_longest_TS_3primeUTR.gff -o ../../maize_gffs/B73_longest_TS_3primeUTR_combined.gff

The commands below were used to assign every TE 1 genomic location. Once a TE overlapped with a feature, it was removed from the list (all the .tmp files). This does priortize finding TEs upstream instead of downstream of genes, if a TE is in a gene dense region where there is less than 10 kb between genes.

B73 TE locations in or within 10 kb of a gene with new UTR files 
bedtools intersect -a ../sarah_te_files/B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b B73_longest_TS_onlygenes.gff -F 1 -s -wa | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_encompassing_gene\t0"}' > B73_filteredTE_location_bp.togenes_long.ts.txt
bedtools intersect -a ../sarah_te_files/B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b B73_longest_TS_onlygenes.gff -F 1 -s -v -wa | sort | uniq > B73_filteredTE_remainingTEs.tmp
bedtools intersect -a B73_filteredTE_remainingTEs.tmp -b B73_longest_TS_5primeUTR_combined.gff -f 1 -s -wo | cut -f 9 | tr "=" "\t" | tr ";" "\t" | cut -f 2 | awk '{print $1"\t5prime_UTR\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs.tmp -b B73_longest_TS_5primeUTR_combined.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs2.tmp
bedtools intersect -a B73_filteredTE_remainingTEs2.tmp -b B73_longest_TS_3primeUTR_combined.gff -f 1 -s -wo | cut -f 9 | tr "=" "\t" | tr ";" "\t" | cut -f 2 | awk '{print $1"\t3prime_UTR\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs2.tmp -b B73_longest_TS_3primeUTR_combined.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs3.tmp
bedtools intersect -a B73_filteredTE_remainingTEs3.tmp -b B73_longest_TS_exon.gff -f 1 -s -wo | cut -f 9,12 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\t"$5"\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs3.tmp -b B73_longest_TS_exon.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs4.tmp
bedtools intersect -a B73_filteredTE_remainingTEs4.tmp -b B73_longest_TS_intron.gff -f 1 -s -wo | cut -f 9,12 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\t"$5"\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs4.tmp -b B73_longest_TS_intron.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs5.tmp
bedtools intersect -a B73_filteredTE_remainingTEs5.tmp -b B73_longest_TS_onlygenes.gff -f 1 -s -wa | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_encompassed_by_gene\t0"}' >> B73_filteredTE_location_bp.togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs5.tmp -b B73_longest_TS_onlygenes.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs6.tmp
bedtools intersect -a <(grep "[^1-9]" B73_filteredTE_remainingTEs6.tmp) -b <(grep "^[1-9]" B73_long.ts_merged.genes_10kb.upstream_overlap.rmvd.gtf | cut -f 1-9) -wo -s | cut -f 5,9,14 | tr "=" "\t" | tr ";" "\t" | awk '{distance=$6-$1; if (distance >=0) print $3"\tw.in_10kb.upstream\t"distance; else print $3"\tw.in_10kb.upstream\tte_part_ingene"}' >> B73_filteredTE_location_bp.togenes_long.ts.txt
bedtools intersect -a <(grep "[^1-9]" B73_filteredTE_remainingTEs6.tmp) -b <(grep "^[1-9]" B73_long.ts_merged.genes_10kb.upstream_overlap.rmvd.gtf | cut -f 1-9) -wa -v | sort | uniq > B73_filteredTE_remainingTEs7.tmp
bedtools intersect -a <(grep "[^1-9]" B73_filteredTE_remainingTEs7.tmp) -b <(grep "^[1-9]" B73_long.ts_merged.genes_10kb.downstream_overlap.rmvd.gtf | cut -f 1-9) -wo -s | cut -f 4,9,13 | tr "=" "\t" | tr ";" "\t" | awk '{distance=$1-$6; if (distance >=0) print $3"\tw.in_10kb.downstream\t"distance; else print $3"\tw.in_10kb.downstream\tte_part_ingene"}' >> B73_filteredTE_location_bp.togenes_long.ts.txt

python rem_dups_TElocation.py B73_filteredTE_location_bp.togenes_long.ts.txt B73_filteredTE_location_bp.togenes_long.ts.nodups.txt

#B73 TE locations with new UTR files and save gene names 
#want gene names without transcript numbers
bedtools intersect -a ../sarah_te_files/B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b B73_longest_TS_onlygenes.gff -F 1 -s -wo | sort | uniq | cut -f 9,18 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\t"$8"\tTE_encompassing_gene\t0"}' > B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt
bedtools intersect -a ../sarah_te_files/B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b B73_longest_TS_onlygenes.gff -F 1 -s -v -wa | sort | uniq > B73_filteredTE_remainingTEs.tmp
bedtools intersect -a B73_filteredTE_remainingTEs.tmp -b B73_longest_TS_5primeUTR_combined.gff -f 1 -s -wo | cut -f 9,18 | tr "=" "\t" | tr ";" "\t" | cut -f 2,6 | tr "_" "\t" | cut -f 1,2 | awk '{print $1"\t"$2"\t5prime_UTR\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs.tmp -b B73_longest_TS_5primeUTR_combined.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs2.tmp
bedtools intersect -a B73_filteredTE_remainingTEs2.tmp -b B73_longest_TS_3primeUTR_combined.gff -f 1 -s -wo | cut -f 9,18 | tr "=" "\t" | tr ";" "\t" | cut -f 2,6 | tr "_" "\t" | cut -f 1,2 | awk '{print $1"\t"$2"\t3prime_UTR\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs2.tmp -b B73_longest_TS_3primeUTR_combined.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs3.tmp
bedtools intersect -a B73_filteredTE_remainingTEs3.tmp -b B73_longest_TS_exon.gff -f 1 -s -wo | cut -f 9,12,18 | tr "=" "\t" | tr ";" "\t" | cut -f 2,5,7 | tr "_" "\t" | awk '{print $1"\t"$3"\t"$2"\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs3.tmp -b B73_longest_TS_exon.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs4.tmp
bedtools intersect -a B73_filteredTE_remainingTEs4.tmp -b B73_longest_TS_intron.gff -f 1 -s -wo | cut -f 9,12,18 | tr "=" "\t" | tr ";" "\t" | cut -f 2,5,7 | tr "_" "\t" | tr ":" "\t" | awk '{print $1"\t"$4"\t"$2"\t0"}' | sort | uniq >> B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs4.tmp -b B73_longest_TS_intron.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs5.tmp
bedtools intersect -a B73_filteredTE_remainingTEs5.tmp -b B73_longest_TS_onlygenes.gff -f 1 -s -wo | sort | uniq | cut -f 9,18 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\t"$8"\tTE_encompassed_by_gene\t0"}' >> B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs5.tmp -b B73_longest_TS_onlygenes.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs6.tmp
bedtools intersect -a <(grep "[^1-9]" B73_filteredTE_remainingTEs6.tmp) -b <(grep "^[1-9]" B73_long.ts_merged.genes_10kb.upstream_overlap.rmvd.gtf | cut -f 1-9) -wo -s | cut -f 5,9,14,18 | tr "=" "\t" | tr ";" "\t"  | cut -f 1,3,6,8 | tr "_" "\t" | cut -f 1-4 | awk '{distance=$3-$1; if (distance >= 0) print $2"\t"$4"\tw.in_10kb.upstream\t"distance; else print $2"\t"$4"\tw.in_10kb.upstream\tte_part_ingene"}' >> B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt
bedtools intersect -a <(grep "[^1-9]" B73_filteredTE_remainingTEs6.tmp) -b <(grep "^[1-9]" B73_long.ts_merged.genes_10kb.upstream_overlap.rmvd.gtf | cut -f 1-9) -wa -v | sort | uniq > B73_filteredTE_remainingTEs7.tmp
bedtools intersect -a <(grep "[^1-9]" B73_filteredTE_remainingTEs7.tmp) -b <(grep "^[1-9]" B73_long.ts_merged.genes_10kb.downstream_overlap.rmvd.gtf | cut -f 1-9) -wo -s | cut -f 4,9,13,18 | tr "=" "\t" | tr ";" "\t" | cut -f 1,3,6,8 | tr "_" "\t" | cut -f 1-4 | awk '{distance=$1-$3; if (distance >=0) print $2"\t"$4"\tw.in_10kb.downstream\t"distance; else print $2"\t"$4"\tw.in_10kb.downstream\tte_part_ingene"}' >> B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt

python rem_dups_TElocation_w.genename.py B73_filteredTE_location_bp.togenes_w.genename_long.ts.txt B73_filteredTE_location_bp.togenes_w.genename_long.ts.nodups.txt
#there are some TEs that overlap etc with multiple genes, will get rid of duplicates in R

Assign every TE to a genomic location: 
bedtools intersect -a ../sarah_te_files/B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b B73_longest_TS_onlygenes.gff -F 1 -s -wa | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_encompassing_gene"}' > B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a ../sarah_te_files/B73.structuralTEv2.2018.12.20.filteredTE.gff3 -b B73_longest_TS_onlygenes.gff -F 1 -s -v -wa | sort | uniq > B73_filteredTE_remainingTEs.tmp
bedtools intersect -a B73_filteredTE_remainingTEs.tmp -b B73_longest_TS_5primeUTR_combined.gff -f 1 -s -wo | cut -f 9 | tr "=" "\t" | tr ";" "\t" | cut -f 2 | awk '{print $1"\t5prime_UTR"}' | sort | uniq >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs.tmp -b B73_longest_TS_5primeUTR_combined.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs2.tmp
bedtools intersect -a B73_filteredTE_remainingTEs2.tmp -b B73_longest_TS_3primeUTR_combined.gff -f 1 -s -wo | cut -f 9 | tr "=" "\t" | tr ";" "\t" | cut -f 2 | awk '{print $1"\t3prime_UTR"}' | sort | uniq >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs2.tmp -b B73_longest_TS_3primeUTR_combined.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs3.tmp
bedtools intersect -a B73_filteredTE_remainingTEs3.tmp -b B73_longest_TS_exon.gff -f 1 -s -wo | cut -f 9,12 | tr "=" "\t" | tr ";" "\t" | cut -f 2,5 | sort | uniq >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs3.tmp -b B73_longest_TS_exon.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs4.tmp
bedtools intersect -a B73_filteredTE_remainingTEs4.tmp -b B73_longest_TS_intron.gff -f 1 -s -wo | cut -f 9,12 | tr "=" "\t" | tr ";" "\t" | cut -f 2,5 | sort | uniq >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs4.tmp -b B73_longest_TS_intron.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs5.tmp
bedtools intersect -a B73_filteredTE_remainingTEs5.tmp -b B73_longest_TS_onlygenes.gff -f 1 -s -wa | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_encompassed_by_gene"}' >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs5.tmp -b B73_longest_TS_onlygenes.gff -f 1 -s -wa -v | sort | uniq > B73_filteredTE_remainingTEs6.tmp
bedtools intersect -a B73_filteredTE_remainingTEs6.tmp -b <(grep "^[1-9]" B73_just.genes_1kb.upstream_long.ts.gtf) -wa -s | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_1kb_upstream"}' >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs6.tmp -b <(grep "^[1-9]" B73_just.genes_1kb.upstream_long.ts.gtf) -wa -s -v > B73_filteredTE_remainingTEs7.tmp
bedtools intersect -a B73_filteredTE_remainingTEs7.tmp -b <(grep "^[1-9]" B73_just.genes_5.1kb.upstream_long.ts.gtf) -wa -s | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_5.1kb_upstream"}' >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs7.tmp -b <(grep "^[1-9]" B73_just.genes_5.1kb.upstream_long.ts.gtf) -wa -s -v > B73_filteredTE_remainingTEs8.tmp
bedtools intersect -a B73_filteredTE_remainingTEs8.tmp -b <(grep "^[1-9]" B73_just.genes_5.10kb.upstream_long.ts.gtf) -wa -s | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_10.5kb_upstream"}' >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs8.tmp -b <(grep "^[1-9]" B73_just.genes_5.10kb.upstream_long.ts.gtf) -wa -s -v > B73_filteredTE_remainingTEs9.tmp
bedtools intersect -a B73_filteredTE_remainingTEs9.tmp -b <(grep "^[1-9]" B73_just.genes_1kb.downstream_long.ts.gtf) -wa -s | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_1kb_downstream"}' >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs9.tmp -b <(grep "^[1-9]" B73_just.genes_1kb.downstream_long.ts.gtf) -wa -s -v > B73_filteredTE_remainingTEs10.tmp
bedtools intersect -a B73_filteredTE_remainingTEs10.tmp -b <(grep "^[1-9]" B73_just.genes_1.5kb.downstream_long.ts.gtf) -wa -s | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_1.5kb_downstream"}' >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs10.tmp -b <(grep "^[1-9]" B73_just.genes_1.5kb.downstream_long.ts.gtf) -wa -s -v > B73_filteredTE_remainingTEs11.tmp
bedtools intersect -a B73_filteredTE_remainingTEs11.tmp -b <(grep "^[1-9]" B73_just.genes_5.10kb.downstream_long.ts.gtf) -wa -s | sort | uniq | cut -f 9 | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_5.10kb_downstream"}' >> B73_filteredTE_location_togenes_long.ts.txt
bedtools intersect -a B73_filteredTE_remainingTEs11.tmp -b <(grep "^[1-9]" B73_just.genes_5.10kb.downstream_long.ts.gtf) -wa -s -v > B73_filteredTE_remainingTEs12.tmp
cut -f 9 B73_filteredTE_remainingTEs12.tmp | sort | uniq | tr "=" "\t" | tr ";" "\t" | awk '{print $2"\tTE_intergenic"}' >> B73_filteredTE_location_togenes_long.ts.txt

Remove tmp files 

